<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of addRxns</title>
  <meta name="keywords" content="addRxns">
  <meta name="description" content="addRxns">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">RAVEN</a> &gt; addRxns.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for RAVEN&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>addRxns
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>addRxns</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> addRxns
   Adds reactions to a model

   model            a model structure
   rxnsToAdd        the reaction structure can have the following fields:
                    rxns       cell array with unique strings that 
                               identifies each reaction
                    equations  cell array with equation strings. Decimal 
                               coefficients are expressed as “1.2”. 
                               Reversibility is indicated by “&lt;=&gt;” or “=&gt;”
                    rxnNames   cell array with the names of each reaction
                               (opt, default '')
                    lb         vector with the lower bounds (opt, default
                               -inf for reversible reactions and 0 for
                               irreversible)
                    ub         vector with the upper bounds (opt, default
                               inf)
                    c          vector with the objective function
                               coefficients (opt, default 0)
                    eccodes    cell array with the EC-numbers for each
                               reactions. Delimit several EC-numbers with
                               &quot;;&quot; (opt, default '')
                    subSystems cell array with the subsystems for each
                               reaction (opt, default '')
                    grRules    cell array with the gene-reaction
                               relationship for each reaction. For example
                               &quot;(A and B) or (C)&quot; means that the reaction 
                               could be catalyzed by a complex between 
                               A &amp; B or by C on its own. All the genes 
                               have to be present in model.genes. Add 
                               genes with addGenes before calling this
                               function if needed (opt, default '')
                    rxnMiriams cell array with Miriam structures (opt,
                               default [])
                    rxnComps   cell array with compartments (as in
                               model.comps) (opt, default {})
   eqnType          double describing how the equation string should be
                    interpreted
                    1 - The metabolites are matched to model.mets. New
                        metabolites (if allowed) are added to
                        &quot;compartment&quot;
                    2 - The metabolites are matched to model.metNames and
                        all metabolites are assigned to &quot;compartment&quot;. Any
                        new metabolites that are added will be assigned
                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are 
                        already used in the model then the numbering will
                        start from the highest used integer+1
                    3 - The metabolites are written as 
                        &quot;metNames[comps]&quot;. Only compartments in
                        model.comps are allowed. Any
                        new metabolites that are added will be assigned
                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are 
                        already used in the model then the numbering will
                        start from the highest used integer+1  
   compartment      a string with the compartment the metabolites should
                    be placed in when using eqnType=2. Must match 
                    model.comps (opt when eqnType=1 or eqnType=3) 
   allowNewMets     true if the function is allowed to add new
                    metabolites. It is highly recommended to first add
                    any new metabolites with addMets rather than
                    automatically through this function. addMets supports
                    more annotation of metabolites, allows for the use of
                    exchange metabolites, and using it reduces the risk
                    of parsing errors (opt, default false)
                     
   newModel         an updated model structure

   NOTE: This function does not make extensive checks about formatting of
   gene-reaction rules. 

   NOTE: When adding metabolites to a compartment where it previously
   doesn't exist, the function will copy any available information from
   the metabolite in another compartment.

   Usage: newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets)

   Rasmus Agren, 2014-01-06</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo)">addMets</a>	addMets</li><li><a href="constructS.html" class="code" title="function [S mets badRxns reversible]=constructS(equations,mets,rxns)">constructS</a>	constructS</li><li><a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>	dispEM</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="changeRxns.html" class="code" title="function model=changeRxns(model,rxns,equations,eqnType,compartment,allowNewMets)">changeRxns</a>	changeRxns</li><li><a href="checkTasks.html" class="code" title="function [taskReport essentialRxns taskStructure]=checkTasks(model,inputFile,printOutput,printOnlyFailed,getEssential,taskStructure)">checkTasks</a>	checkTasks</li><li><a href="fitTasks.html" class="code" title="function [outModel addedRxns]=fitTasks(model,refModel,inputFile,printOutput,rxnScores,taskStructure,params)">fitTasks</a>	fitTasks</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets)</a>
0002 <span class="comment">% addRxns</span>
0003 <span class="comment">%   Adds reactions to a model</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   model            a model structure</span>
0006 <span class="comment">%   rxnsToAdd        the reaction structure can have the following fields:</span>
0007 <span class="comment">%                    rxns       cell array with unique strings that</span>
0008 <span class="comment">%                               identifies each reaction</span>
0009 <span class="comment">%                    equations  cell array with equation strings. Decimal</span>
0010 <span class="comment">%                               coefficients are expressed as “1.2”.</span>
0011 <span class="comment">%                               Reversibility is indicated by “&lt;=&gt;” or “=&gt;”</span>
0012 <span class="comment">%                    rxnNames   cell array with the names of each reaction</span>
0013 <span class="comment">%                               (opt, default '')</span>
0014 <span class="comment">%                    lb         vector with the lower bounds (opt, default</span>
0015 <span class="comment">%                               -inf for reversible reactions and 0 for</span>
0016 <span class="comment">%                               irreversible)</span>
0017 <span class="comment">%                    ub         vector with the upper bounds (opt, default</span>
0018 <span class="comment">%                               inf)</span>
0019 <span class="comment">%                    c          vector with the objective function</span>
0020 <span class="comment">%                               coefficients (opt, default 0)</span>
0021 <span class="comment">%                    eccodes    cell array with the EC-numbers for each</span>
0022 <span class="comment">%                               reactions. Delimit several EC-numbers with</span>
0023 <span class="comment">%                               &quot;;&quot; (opt, default '')</span>
0024 <span class="comment">%                    subSystems cell array with the subsystems for each</span>
0025 <span class="comment">%                               reaction (opt, default '')</span>
0026 <span class="comment">%                    grRules    cell array with the gene-reaction</span>
0027 <span class="comment">%                               relationship for each reaction. For example</span>
0028 <span class="comment">%                               &quot;(A and B) or (C)&quot; means that the reaction</span>
0029 <span class="comment">%                               could be catalyzed by a complex between</span>
0030 <span class="comment">%                               A &amp; B or by C on its own. All the genes</span>
0031 <span class="comment">%                               have to be present in model.genes. Add</span>
0032 <span class="comment">%                               genes with addGenes before calling this</span>
0033 <span class="comment">%                               function if needed (opt, default '')</span>
0034 <span class="comment">%                    rxnMiriams cell array with Miriam structures (opt,</span>
0035 <span class="comment">%                               default [])</span>
0036 <span class="comment">%                    rxnComps   cell array with compartments (as in</span>
0037 <span class="comment">%                               model.comps) (opt, default {})</span>
0038 <span class="comment">%   eqnType          double describing how the equation string should be</span>
0039 <span class="comment">%                    interpreted</span>
0040 <span class="comment">%                    1 - The metabolites are matched to model.mets. New</span>
0041 <span class="comment">%                        metabolites (if allowed) are added to</span>
0042 <span class="comment">%                        &quot;compartment&quot;</span>
0043 <span class="comment">%                    2 - The metabolites are matched to model.metNames and</span>
0044 <span class="comment">%                        all metabolites are assigned to &quot;compartment&quot;. Any</span>
0045 <span class="comment">%                        new metabolites that are added will be assigned</span>
0046 <span class="comment">%                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are</span>
0047 <span class="comment">%                        already used in the model then the numbering will</span>
0048 <span class="comment">%                        start from the highest used integer+1</span>
0049 <span class="comment">%                    3 - The metabolites are written as</span>
0050 <span class="comment">%                        &quot;metNames[comps]&quot;. Only compartments in</span>
0051 <span class="comment">%                        model.comps are allowed. Any</span>
0052 <span class="comment">%                        new metabolites that are added will be assigned</span>
0053 <span class="comment">%                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are</span>
0054 <span class="comment">%                        already used in the model then the numbering will</span>
0055 <span class="comment">%                        start from the highest used integer+1</span>
0056 <span class="comment">%   compartment      a string with the compartment the metabolites should</span>
0057 <span class="comment">%                    be placed in when using eqnType=2. Must match</span>
0058 <span class="comment">%                    model.comps (opt when eqnType=1 or eqnType=3)</span>
0059 <span class="comment">%   allowNewMets     true if the function is allowed to add new</span>
0060 <span class="comment">%                    metabolites. It is highly recommended to first add</span>
0061 <span class="comment">%                    any new metabolites with addMets rather than</span>
0062 <span class="comment">%                    automatically through this function. addMets supports</span>
0063 <span class="comment">%                    more annotation of metabolites, allows for the use of</span>
0064 <span class="comment">%                    exchange metabolites, and using it reduces the risk</span>
0065 <span class="comment">%                    of parsing errors (opt, default false)</span>
0066 <span class="comment">%</span>
0067 <span class="comment">%   newModel         an updated model structure</span>
0068 <span class="comment">%</span>
0069 <span class="comment">%   NOTE: This function does not make extensive checks about formatting of</span>
0070 <span class="comment">%   gene-reaction rules.</span>
0071 <span class="comment">%</span>
0072 <span class="comment">%   NOTE: When adding metabolites to a compartment where it previously</span>
0073 <span class="comment">%   doesn't exist, the function will copy any available information from</span>
0074 <span class="comment">%   the metabolite in another compartment.</span>
0075 <span class="comment">%</span>
0076 <span class="comment">%   Usage: newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets)</span>
0077 <span class="comment">%</span>
0078 <span class="comment">%   Rasmus Agren, 2014-01-06</span>
0079 <span class="comment">%</span>
0080 
0081 <span class="keyword">if</span> nargin&lt;4
0082     compartment=[];
0083 <span class="keyword">end</span>
0084 <span class="keyword">if</span> nargin&lt;5
0085     allowNewMets=false;
0086 <span class="keyword">end</span>
0087 
0088 newModel=model;
0089 
0090 <span class="comment">%If no reactions should be added</span>
0091 <span class="keyword">if</span> isempty(rxnsToAdd)
0092     <span class="keyword">return</span>;
0093 <span class="keyword">end</span>
0094 
0095 <span class="comment">%Check the input</span>
0096 <span class="keyword">if</span> ~isnumeric(eqnType)
0097     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'eqnType must be numeric'</span>);
0098 <span class="keyword">else</span>
0099     <span class="keyword">if</span> ~ismember(eqnType,[1 2 3])
0100         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'eqnType must be 1, 2, or 3'</span>);
0101     <span class="keyword">end</span>
0102 <span class="keyword">end</span>
0103 
0104 <span class="keyword">if</span> eqnType==2 || (eqnType==1 &amp;&amp; allowNewMets==true)
0105     <span class="keyword">if</span> ~ischar(compartment)
0106         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'compartment must be a string'</span>);
0107     <span class="keyword">end</span>
0108     <span class="keyword">if</span> ~ismember(compartment,model.comps)
0109         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'compartment must match one of the compartments in model.comps'</span>);
0110     <span class="keyword">end</span>
0111 <span class="keyword">end</span>
0112 
0113 <span class="keyword">if</span> ~isfield(rxnsToAdd,<span class="string">'rxns'</span>)
0114     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxns is a required field in rxnsToAdd'</span>);
0115 <span class="keyword">else</span>
0116     <span class="comment">%To fit with some later printing</span>
0117     rxnsToAdd.rxns=rxnsToAdd.rxns(:);
0118 <span class="keyword">end</span>
0119 <span class="keyword">if</span> ~isfield(rxnsToAdd,<span class="string">'equations'</span>)
0120     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'equations is a required field in rxnsToAdd'</span>);
0121 <span class="keyword">end</span>
0122 
0123 <span class="keyword">if</span> any(ismember(rxnsToAdd.rxns,model.rxns))
0124     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'One or more reaction id was already present in the model. Use changeRxns or remove the existing reactions before adding new ones'</span>);
0125 <span class="keyword">end</span>
0126 
0127 <span class="keyword">if</span> ~iscellstr(rxnsToAdd.rxns) &amp;&amp; ~ischar(rxnsToAdd.rxns)
0128     <span class="comment">%It could also be a string, but it's not encouraged</span>
0129     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.rxns must be a cell array of strings'</span>);
0130 <span class="keyword">else</span>
0131     rxnsToAdd.rxns=cellstr(rxnsToAdd.rxns);
0132 <span class="keyword">end</span>
0133 <span class="keyword">if</span> ~iscellstr(rxnsToAdd.equations) &amp;&amp; ~ischar(rxnsToAdd.equations)
0134     <span class="comment">%It could also be a string, but it's not encouraged</span>
0135     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.equations must be a cell array of strings'</span>);
0136 <span class="keyword">else</span>
0137     rxnsToAdd.equations=cellstr(rxnsToAdd.equations);
0138 <span class="keyword">end</span>
0139 
0140 <span class="comment">%Check some formatting</span>
0141 illegalCells=regexp(rxnsToAdd.rxns,<span class="string">'[^a-z_A-Z0-9]'</span>, <span class="string">'once'</span>);
0142 <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'Illegal character(s) in reaction IDs:'</span>,true,rxnsToAdd.rxns(~cellfun(@isempty,illegalCells)));
0143 
0144 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnNames'</span>)
0145     illegalCells=regexp(rxnsToAdd.rxnNames,<span class="string">'[&quot;%&lt;&gt;\\]'</span>, <span class="string">'once'</span>);
0146     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'Illegal character(s) in reaction names:'</span>,true,rxnsToAdd.rxnNames(~cellfun(@isempty,illegalCells)));
0147 <span class="keyword">end</span>
0148 
0149 nRxns=numel(rxnsToAdd.rxns);
0150 nOldRxns=numel(model.rxns);
0151 filler=cell(nRxns,1);
0152 filler(:)={<span class="string">''</span>};
0153 largeFiller=cell(nOldRxns,1);
0154 largeFiller(:)={<span class="string">''</span>};
0155 
0156 <span class="comment">%***Add everything to the model except for the equations.</span>
0157 <span class="keyword">if</span> numel(rxnsToAdd.equations)~=nRxns
0158    <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.equations must have the same number of elements as rxnsToAdd.rxns'</span>);
0159 <span class="keyword">end</span>
0160 
0161 <span class="comment">%Parse the equations. This is done at this early stage since I need the</span>
0162 <span class="comment">%reversibility info</span>
0163 [S mets badRxns reversible]=<a href="constructS.html" class="code" title="function [S mets badRxns reversible]=constructS(equations,mets,rxns)">constructS</a>(rxnsToAdd.equations);
0164 <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'The following equations have one or more metabolites both as substrate and product. Only the net equations will be added:'</span>,false,rxnsToAdd.rxns(badRxns));
0165 
0166 newModel.rev=[newModel.rev;reversible];
0167 newModel.rxns=[newModel.rxns;rxnsToAdd.rxns(:)];
0168 
0169 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnNames'</span>)
0170    <span class="keyword">if</span> numel(rxnsToAdd.rxnNames)~=nRxns
0171        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.rxnNames must have the same number of elements as rxnsToAdd.rxns'</span>);
0172    <span class="keyword">end</span>
0173    <span class="comment">%Fill with standard if it doesn't exist</span>
0174    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnNames'</span>)
0175        newModel.rxnNames=largeFiller;
0176    <span class="keyword">end</span>
0177    newModel.rxnNames=[newModel.rxnNames;rxnsToAdd.rxnNames(:)];
0178 <span class="keyword">else</span>
0179     <span class="comment">%Fill with standard if it doesn't exist</span>
0180    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnNames'</span>)
0181        newModel.rxnNames=[newModel.rxnNames;filler];
0182    <span class="keyword">end</span>
0183 <span class="keyword">end</span>
0184 
0185 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'lb'</span>)
0186    <span class="keyword">if</span> numel(rxnsToAdd.lb)~=nRxns
0187        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.lb must have the same number of elements as rxnsToAdd.rxns'</span>);
0188    <span class="keyword">end</span>
0189    <span class="comment">%Fill with standard if it doesn't exist</span>
0190    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'lb'</span>)
0191        newModel.lb=zeros(nOldRxns,1);
0192        newModel.lb(newModel.rev~=0)=-inf;
0193    <span class="keyword">end</span>
0194    newModel.lb=[newModel.lb;rxnsToAdd.lb(:)];
0195 <span class="keyword">else</span>
0196     <span class="comment">%Fill with standard if it doesn't exist</span>
0197    <span class="keyword">if</span> isfield(newModel,<span class="string">'lb'</span>)
0198        I=zeros(nRxns,1);
0199        I(reversible~=0)=-inf;
0200        newModel.lb=[newModel.lb;I];
0201    <span class="keyword">end</span>
0202 <span class="keyword">end</span>
0203 
0204 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'ub'</span>)
0205    <span class="keyword">if</span> numel(rxnsToAdd.ub)~=nRxns
0206        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.ub must have the same number of elements as rxnsToAdd.rxns'</span>);
0207    <span class="keyword">end</span>
0208    <span class="comment">%Fill with standard if it doesn't exist</span>
0209    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'ub'</span>)
0210        newModel.ub=inf(nOldRxns,1);
0211    <span class="keyword">end</span>
0212    newModel.ub=[newModel.ub;rxnsToAdd.ub(:)];
0213 <span class="keyword">else</span>
0214     <span class="comment">%Fill with standard if it doesn't exist</span>
0215    <span class="keyword">if</span> isfield(newModel,<span class="string">'ub'</span>)
0216        newModel.ub=[newModel.ub;inf(nRxns,1)];
0217    <span class="keyword">end</span>
0218 <span class="keyword">end</span>
0219 
0220 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'c'</span>)
0221    <span class="keyword">if</span> numel(rxnsToAdd.c)~=nRxns
0222        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.c must have the same number of elements as rxnsToAdd.rxns'</span>);
0223    <span class="keyword">end</span>
0224    <span class="comment">%Fill with standard if it doesn't exist</span>
0225    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'c'</span>)
0226        newModel.c=zeros(nOldRxns,1);
0227    <span class="keyword">end</span>
0228    newModel.c=[newModel.c;rxnsToAdd.c(:)];
0229 <span class="keyword">else</span>
0230     <span class="comment">%Fill with standard if it doesn't exist</span>
0231    <span class="keyword">if</span> isfield(newModel,<span class="string">'c'</span>)
0232        newModel.c=[newModel.c;zeros(nRxns,1)];
0233    <span class="keyword">end</span>
0234 <span class="keyword">end</span>
0235 
0236 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'eccodes'</span>)
0237    <span class="keyword">if</span> numel(rxnsToAdd.eccodes)~=nRxns
0238        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.eccodes must have the same number of elements as rxnsToAdd.rxns'</span>);
0239    <span class="keyword">end</span>
0240    <span class="comment">%Fill with standard if it doesn't exist</span>
0241    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'eccodes'</span>)
0242        newModel.eccodes=largeFiller;
0243    <span class="keyword">end</span>
0244    newModel.eccodes=[newModel.eccodes;rxnsToAdd.eccodes(:)];
0245 <span class="keyword">else</span>
0246     <span class="comment">%Fill with standard if it doesn't exist</span>
0247    <span class="keyword">if</span> isfield(newModel,<span class="string">'eccodes'</span>)
0248        newModel.eccodes=[newModel.eccodes;filler];
0249    <span class="keyword">end</span>
0250 <span class="keyword">end</span>
0251 
0252 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'subSystems'</span>)
0253    <span class="keyword">if</span> numel(rxnsToAdd.subSystems)~=nRxns
0254        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.subSystems must have the same number of elements as rxnsToAdd.rxns'</span>);
0255    <span class="keyword">end</span>
0256    <span class="comment">%Fill with standard if it doesn't exist</span>
0257    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'subSystems'</span>)
0258        newModel.subSystems=largeFiller;
0259    <span class="keyword">end</span>
0260    newModel.subSystems=[newModel.subSystems;rxnsToAdd.subSystems(:)];
0261 <span class="keyword">else</span>
0262     <span class="comment">%Fill with standard if it doesn't exist</span>
0263    <span class="keyword">if</span> isfield(newModel,<span class="string">'subSystems'</span>)
0264        newModel.subSystems=[newModel.subSystems;filler];
0265    <span class="keyword">end</span>
0266 <span class="keyword">end</span>
0267 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnMiriams'</span>)
0268    <span class="keyword">if</span> numel(rxnsToAdd.rxnMiriams)~=nRxns
0269        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.rxnMiriams must have the same number of elements as rxnsToAdd.rxns'</span>);
0270    <span class="keyword">end</span>
0271    <span class="comment">%Fill with standard if it doesn't exist</span>
0272    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnMiriams'</span>)
0273        newModel.rxnMiriams=cell(nOldRxns,1);
0274    <span class="keyword">end</span>
0275    newModel.rxnMiriams=[newModel.rxnMiriams;rxnsToAdd.rxnMiriams(:)];
0276 <span class="keyword">else</span>
0277     <span class="comment">%Fill with standard if it doesn't exist</span>
0278    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnMiriams'</span>)
0279        newModel.rxnMiriams=[newModel.rxnMiriams;cell(nRxns,1)];
0280    <span class="keyword">end</span>
0281 <span class="keyword">end</span>
0282 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnComps'</span>)
0283    <span class="keyword">if</span> numel(rxnsToAdd.rxnComps)~=nRxns
0284        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.rxnComps must have the same number of elements as rxnsToAdd.rxns'</span>);
0285    <span class="keyword">end</span>
0286    <span class="comment">%Fill with standard if it doesn't exist</span>
0287    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnComps'</span>)
0288        newModel.rxnComps=ones(nOldRxns,1);
0289        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'Adding reactions with compartment information to a model without such information. All existing reactions will be assigned to the first compartment'</span>,false);
0290    <span class="keyword">end</span>
0291    newModel.rxnComps=[newModel.rxnComps;rxnsToAdd.rxnComps(:)];
0292 <span class="keyword">else</span>
0293     <span class="comment">%Fill with standard if it doesn't exist</span>
0294    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnComps'</span>)
0295        newModel.rxnComps=[newModel.rxnComps;ones(nRxns,1)];
0296        <span class="comment">%fprintf('NOTE: The added reactions will be assigned to the first compartment\n');</span>
0297    <span class="keyword">end</span>
0298 <span class="keyword">end</span>
0299 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'grRules'</span>)
0300    <span class="keyword">if</span> numel(rxnsToAdd.grRules)~=nRxns
0301        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.grRules must have the same number of elements as rxnsToAdd.rxns'</span>);
0302    <span class="keyword">end</span>
0303    <span class="comment">%Fill with standard if it doesn't exist</span>
0304    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'grRules'</span>)
0305        newModel.grRules=largeFiller;
0306    <span class="keyword">end</span>
0307    newModel.grRules=[newModel.grRules;rxnsToAdd.grRules(:)];
0308 <span class="keyword">else</span>
0309     <span class="comment">%Fill with standard if it doesn't exist</span>
0310    <span class="keyword">if</span> isfield(newModel,<span class="string">'grRules'</span>)
0311        newModel.grRules=[newModel.grRules;filler];
0312    <span class="keyword">end</span>
0313 <span class="keyword">end</span>
0314 
0315 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnFrom'</span>)
0316    <span class="keyword">if</span> numel(rxnsToAdd.rxnFrom)~=nRxns
0317        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'rxnsToAdd.rxnFrom must have the same number of elements as rxnsToAdd.rxns'</span>);
0318    <span class="keyword">end</span>
0319    <span class="comment">%Fill with standard if it doesn't exist</span>
0320    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnFrom'</span>)
0321        newModel.rxnFrom=largeFiller;
0322    <span class="keyword">end</span>
0323    newModel.rxnFrom=[newModel.rxnFrom;rxnsToAdd.rxnFrom(:)];
0324 <span class="keyword">else</span>
0325     <span class="comment">%Fill with standard if it doesn't exist</span>
0326    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnFrom'</span>)
0327        newModel.rxnFrom=[newModel.rxnFrom;filler];
0328    <span class="keyword">end</span>
0329 <span class="keyword">end</span>
0330 
0331 <span class="comment">%Check that ids contain no weird characters. This is only done if the</span>
0332 <span class="comment">%equations are with metabolite ids</span>
0333 <span class="keyword">if</span> eqnType==1
0334     illegalCells=regexp(mets,<span class="string">'[^a-z_A-Z0-9]'</span>, <span class="string">'once'</span>);
0335     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'Illegal character(s) in metabolite IDs:'</span>,true,mets(~cellfun(@isempty,illegalCells)));
0336 <span class="keyword">else</span>
0337     <span class="comment">%If the mets are metNames</span>
0338     illegalCells=regexp(mets,<span class="string">'[&quot;%&lt;&gt;\\]'</span>, <span class="string">'once'</span>);
0339     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'Illegal character(s) in metabolite names:'</span>,true,mets(~cellfun(@isempty,illegalCells)));
0340 <span class="keyword">end</span>
0341 
0342 <span class="comment">%***Start parsing the equations and adding the info to the S matrix</span>
0343 <span class="comment">%The mets are matched to model.mets</span>
0344 <span class="keyword">if</span> eqnType==1
0345     [I J]=ismember(mets,model.mets);
0346     <span class="keyword">if</span> ~all(I)
0347         <span class="keyword">if</span> allowNewMets==true
0348             <span class="comment">%Add the new mets</span>
0349             metsToAdd.mets=mets(~I);
0350             metsToAdd.metNames=metsToAdd.mets;
0351             metsToAdd.compartments=compartment;
0352             newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo)">addMets</a>(newModel,metsToAdd);
0353         <span class="keyword">else</span>
0354             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'One or more equations contain metabolites that are not in model.mets. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>);
0355         <span class="keyword">end</span>
0356     <span class="keyword">end</span>
0357     <span class="comment">%Calculate the indexes of the metabolites and add the info</span>
0358     metIndexes=J;
0359     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0360 <span class="keyword">end</span>
0361 
0362 <span class="comment">%Do some stuff that is the same for eqnType=2 and eqnType=3</span>
0363 <span class="keyword">if</span> eqnType==2 || eqnType==3
0364     <span class="comment">%For later..</span>
0365     t2=strcat(model.metNames,<span class="string">'¤¤¤'</span>,model.comps(model.metComps));
0366 <span class="keyword">end</span>
0367 
0368 <span class="comment">%The mets are matched to model.metNames and assigned to &quot;compartment&quot;</span>
0369 <span class="keyword">if</span> eqnType==2
0370     <span class="comment">%%Check that the metabolite names aren't present in the same compartment.</span>
0371     <span class="comment">%Not the neatest way maybe..</span>
0372     t1=strcat(mets,<span class="string">'¤¤¤'</span>,compartment);
0373     [I J]=ismember(t1,t2);
0374  
0375     <span class="keyword">if</span> ~all(I)
0376         <span class="keyword">if</span> allowNewMets==true
0377             <span class="comment">%Add the new mets</span>
0378             metsToAdd.metNames=mets(~I);
0379             metsToAdd.compartments=compartment;
0380             newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo)">addMets</a>(newModel,metsToAdd);
0381         <span class="keyword">else</span>
0382             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'One or more equations contain metabolites that are not in model.mets. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>);
0383         <span class="keyword">end</span>
0384     <span class="keyword">end</span>
0385     
0386     <span class="comment">%Calculate the indexes of the metabolites</span>
0387     metIndexes=J;
0388     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0389 <span class="keyword">end</span>
0390 
0391 <span class="comment">%The equations are on the form metNames[compName]</span>
0392 <span class="keyword">if</span> eqnType==3
0393     <span class="comment">%Parse the metabolite names</span>
0394     metNames=cell(numel(mets),1);
0395     compartments=metNames;
0396     <span class="keyword">for</span> i=1:numel(mets)
0397         starts=max(strfind(mets{i},<span class="string">'['</span>));
0398         ends=max(strfind(mets{i},<span class="string">']'</span>));
0399         
0400         <span class="comment">%Check that the formatting is correct</span>
0401         <span class="keyword">if</span> isempty(starts) || isempty(ends) || ends&lt;numel(mets{i})
0402             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>([<span class="string">'The metabolite '</span> mets{i} <span class="string">' is not correctly formatted for eqnType=3'</span>]);
0403         <span class="keyword">end</span>
0404         
0405         <span class="comment">%Check that the compartment is correct</span>
0406         compartments{i}=mets{i}(starts+1:ends-1);
0407         I=ismember(compartments(i),newModel.comps);
0408         <span class="keyword">if</span> ~I
0409             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>([<span class="string">'The metabolite '</span> mets{i} <span class="string">' has a compartment that is not in model.comps'</span>]);
0410         <span class="keyword">end</span>
0411         metNames{i}=mets{i}(1:starts-1);
0412     <span class="keyword">end</span>
0413     
0414     <span class="comment">%Check if the metabolite exists already</span>
0415     t1=strcat(metNames,<span class="string">'¤¤¤'</span>,compartments);
0416     [I J]=ismember(t1,t2);
0417  
0418     <span class="keyword">if</span> ~all(I)
0419         <span class="keyword">if</span> allowNewMets==true
0420             <span class="comment">%Add the new mets</span>
0421             metsToAdd.metNames=metNames(~I);
0422             metsToAdd.compartments=compartments(~I);
0423             newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo)">addMets</a>(newModel,metsToAdd);
0424         <span class="keyword">else</span>
0425             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'One or more equations contain metabolites that are not in model.metNames. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>);
0426         <span class="keyword">end</span>
0427     <span class="keyword">end</span>
0428     
0429     <span class="comment">%Calculate the indexes of the metabolites</span>
0430     metIndexes=J;
0431     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0432 <span class="keyword">end</span>
0433 
0434 <span class="comment">%Add the info to the stoichiometric matrix and to the rxnGeneMat. I do this</span>
0435 <span class="comment">%in a loop, but maybe not necessary</span>
0436 newModel.S=[newModel.S sparse(size(newModel.S,1),nRxns)];
0437 <span class="keyword">for</span> i=1:nRxns
0438     newModel.S(metIndexes,nOldRxns+i)=S(:,i);
0439     
0440     <span class="comment">%Parse the grRules and add to rxnGeneMat</span>
0441     <span class="keyword">if</span> isfield(newModel,<span class="string">'grRules'</span>)
0442        rule=newModel.grRules{nOldRxns+i};
0443        rule=strrep(rule,<span class="string">'('</span>,<span class="string">''</span>);
0444        rule=strrep(rule,<span class="string">')'</span>,<span class="string">''</span>);
0445        rule=strrep(rule,<span class="string">' or '</span>,<span class="string">' '</span>);
0446        rule=strrep(rule,<span class="string">' and '</span>,<span class="string">' '</span>);
0447        genes=regexp(rule,<span class="string">' '</span>,<span class="string">'split'</span>);
0448        [I J]=ismember(genes,newModel.genes);
0449        <span class="keyword">if</span> ~all(I) &amp;&amp; any(rule)
0450             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>([<span class="string">'Not all genes for reaction '</span> rxnsToAdd.rxns{i} <span class="string">' were found in model.genes. If needed, add genes with addGenes before calling this function'</span>]);
0451        <span class="keyword">end</span>
0452        <span class="keyword">if</span> any(rule)
0453             newModel.rxnGeneMat(nOldRxns+i,J)=1;
0454        <span class="keyword">else</span>
0455             <span class="comment">%If there are no genes for the reaction, the rxnGeneMat should</span>
0456             <span class="comment">%still be resized</span>
0457             newModel.rxnGeneMat=[newModel.rxnGeneMat;sparse(1,numel(newModel.genes))];
0458        <span class="keyword">end</span>
0459     <span class="keyword">end</span>
0460 <span class="keyword">end</span>
0461 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 06-Jan-2014 14:58:12 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>