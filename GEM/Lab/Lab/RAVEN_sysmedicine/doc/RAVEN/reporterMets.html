<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of reporterMets</title>
  <meta name="keywords" content="reporterMets">
  <meta name="description" content="reporterMets">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">RAVEN</a> &gt; reporterMets.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for RAVEN&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>reporterMets
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>reporterMets</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function repMets=reporterMets(model,genes,genePValues,printResults,outputFile,geneFoldChanges) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> reporterMets
   The Reporter Metabolites algorithm for identifying metabolites around
   which transcriptional changes occur

   model           a model structure
   genes           a cell array of gene names (should match with
                   model.genes)
   genePValues     P-values for differential expression of the genes
   printResults    true if the top 20 Reporter Metabolites should be
                   printed to the screen (opt, default false)
   outputFile      the results are printed to this file (opt)
   geneFoldChanges log-fold changes for the genes. If supplied, then
                   Reporter Metabolites are calculated for only up/down-
                   regulated genes in addition to the full test (opt)

   repMets         an array of structures with the following fields.
       test            a string the describes the genes that were used to 
                       calculate the Reporter Metabolites ('all', 'only up',
                       or 'only down'). The two latter structures are
                       only calculated if geneFoldChanges are supplied.
       mets            a cell array of metabolite IDs for the metabolites for
                       which a score could be calculated
       metZScores      Z-scores for differential expression around each
                       metabolite in &quot;mets&quot;
       metPValues      P-values for differential expression around each
                       metabolite in &quot;mets&quot;
       metNGenes       number of neighbouring genes for each metabolite in
                       &quot;mets&quot;
       meanZ           average Z-scores for the genes around each metabolite
                       in &quot;mets&quot;
       stdZ            standard deviations of the Z-scores around each
                       metabolite in &quot;mets&quot;

   NOTE: For details about the algorithm, see Patil KR, Nielsen J,
   Uncovering transcriptional regulation of metabolism by using metabolic
   network topology. Proc. Natl Acad. Sci. USA 2005;102:2685-2689.

   Usage: repMets=reporterMets(model,genes,genePValues,printResults,...
           outputFile,geneFoldChanges)

   Rasmus Agren, 2013-08-01</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>	dispEM</li><li><a href="reporterMets.html" class="code" title="function repMets=reporterMets(model,genes,genePValues,printResults,outputFile,geneFoldChanges)">reporterMets</a>	reporterMets</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="reporterMets.html" class="code" title="function repMets=reporterMets(model,genes,genePValues,printResults,outputFile,geneFoldChanges)">reporterMets</a>	reporterMets</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function repMets=reporterMets(model,genes,genePValues,printResults,outputFile,geneFoldChanges)</a>
0002 <span class="comment">% reporterMets</span>
0003 <span class="comment">%   The Reporter Metabolites algorithm for identifying metabolites around</span>
0004 <span class="comment">%   which transcriptional changes occur</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%   model           a model structure</span>
0007 <span class="comment">%   genes           a cell array of gene names (should match with</span>
0008 <span class="comment">%                   model.genes)</span>
0009 <span class="comment">%   genePValues     P-values for differential expression of the genes</span>
0010 <span class="comment">%   printResults    true if the top 20 Reporter Metabolites should be</span>
0011 <span class="comment">%                   printed to the screen (opt, default false)</span>
0012 <span class="comment">%   outputFile      the results are printed to this file (opt)</span>
0013 <span class="comment">%   geneFoldChanges log-fold changes for the genes. If supplied, then</span>
0014 <span class="comment">%                   Reporter Metabolites are calculated for only up/down-</span>
0015 <span class="comment">%                   regulated genes in addition to the full test (opt)</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%   repMets         an array of structures with the following fields.</span>
0018 <span class="comment">%       test            a string the describes the genes that were used to</span>
0019 <span class="comment">%                       calculate the Reporter Metabolites ('all', 'only up',</span>
0020 <span class="comment">%                       or 'only down'). The two latter structures are</span>
0021 <span class="comment">%                       only calculated if geneFoldChanges are supplied.</span>
0022 <span class="comment">%       mets            a cell array of metabolite IDs for the metabolites for</span>
0023 <span class="comment">%                       which a score could be calculated</span>
0024 <span class="comment">%       metZScores      Z-scores for differential expression around each</span>
0025 <span class="comment">%                       metabolite in &quot;mets&quot;</span>
0026 <span class="comment">%       metPValues      P-values for differential expression around each</span>
0027 <span class="comment">%                       metabolite in &quot;mets&quot;</span>
0028 <span class="comment">%       metNGenes       number of neighbouring genes for each metabolite in</span>
0029 <span class="comment">%                       &quot;mets&quot;</span>
0030 <span class="comment">%       meanZ           average Z-scores for the genes around each metabolite</span>
0031 <span class="comment">%                       in &quot;mets&quot;</span>
0032 <span class="comment">%       stdZ            standard deviations of the Z-scores around each</span>
0033 <span class="comment">%                       metabolite in &quot;mets&quot;</span>
0034 <span class="comment">%</span>
0035 <span class="comment">%   NOTE: For details about the algorithm, see Patil KR, Nielsen J,</span>
0036 <span class="comment">%   Uncovering transcriptional regulation of metabolism by using metabolic</span>
0037 <span class="comment">%   network topology. Proc. Natl Acad. Sci. USA 2005;102:2685-2689.</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%   Usage: repMets=reporterMets(model,genes,genePValues,printResults,...</span>
0040 <span class="comment">%           outputFile,geneFoldChanges)</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%   Rasmus Agren, 2013-08-01</span>
0043 <span class="comment">%</span>
0044 
0045 <span class="keyword">if</span> nargin&lt;4
0046     printResults=false;
0047 <span class="keyword">end</span>
0048 <span class="keyword">if</span> nargin&lt;5
0049     outputFile=[];
0050 <span class="keyword">end</span>
0051 <span class="keyword">if</span> nargin&lt;6
0052     geneFoldChanges=[];
0053 <span class="keyword">end</span>
0054 
0055 <span class="comment">%Check some stuff</span>
0056 <span class="keyword">if</span> numel(genes)~=numel(genePValues)
0057     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'The number of genes and the number of Z-scores must be the same'</span>); 
0058 <span class="keyword">end</span>
0059 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnGeneMat'</span>)
0060     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'The model structure must have a rxnGeneMat field'</span>); 
0061 <span class="keyword">end</span>
0062 
0063 <span class="comment">%Remove the genes which are not in the model</span>
0064 genePValues(~ismember(genes,model.genes))=[];
0065 genes(~ismember(genes,model.genes))=[];
0066 
0067 <span class="comment">%Convert p-values to Z-scores</span>
0068 geneZScores=norminv(genePValues)*-1;
0069 
0070 <span class="comment">%This is to prevent errors if the p-values are exactly 0 or 1</span>
0071 geneZScores(geneZScores==-inf)=-15;
0072 geneZScores(geneZScores==inf)=15;
0073 
0074 <span class="comment">%For each metabolite, calculate the aggregate Z-score and keep track of</span>
0075 <span class="comment">%the number of neighbouring genes</span>
0076 metZScores=nan(numel(model.mets),1);
0077 metNGenes=nan(numel(model.mets),1);
0078 meanZ=nan(numel(model.mets),1);
0079 stdZ=nan(numel(model.mets),1);
0080 <span class="keyword">for</span> i=1:numel(model.mets)
0081     <span class="comment">%Get the involved rxns</span>
0082     I=model.S(i,:);
0083     
0084     <span class="comment">%Get the involved genes</span>
0085     [crap J]=find(model.rxnGeneMat(I~=0,:));
0086     
0087     <span class="comment">%Find the genes in the gene list</span>
0088     K=find(ismember(genes,model.genes(J)));
0089     
0090     <span class="comment">%Calculate the aggregated Z-score for the metabolite</span>
0091     <span class="keyword">if</span> any(K)
0092         metZScores(i)=sum(geneZScores(K))/sqrt(numel(K));
0093         meanZ(i)=mean(geneZScores(K));
0094         stdZ(i)=std(geneZScores(K));
0095         metNGenes(i)=numel(K);
0096     <span class="keyword">end</span>
0097 <span class="keyword">end</span>
0098 
0099 <span class="comment">%Remove the metabolites which have no Z-scores</span>
0100 mets=model.mets(~isnan(metZScores));
0101 metNames=model.metNames(~isnan(metZScores));
0102 metZScores(isnan(metZScores))=[];
0103 metNGenes(isnan(metNGenes))=[];
0104 meanZ(isnan(meanZ))=[];
0105 stdZ(isnan(stdZ))=[];
0106 
0107 <span class="comment">%Then correct for background by calculating the mean Z-score for random</span>
0108 <span class="comment">%sets of the same size as the ones that were found for the metabolites</span>
0109 sizes=unique(metNGenes);
0110 nGenes=numel(genes);
0111 
0112 <span class="keyword">for</span> i=1:numel(sizes)
0113     <span class="comment">%Sample 100000 sets for each size. Sample with replacement, which may or</span>
0114     <span class="comment">%may not be the best choice.</span>
0115     I=ceil(rand(100000,sizes(i))*nGenes);
0116     J=geneZScores(I);
0117     K=sum(J,2)/sqrt(sizes(i));
0118 
0119     <span class="comment">%Correct all elements of this size</span>
0120     mK=mean(K);
0121     stdK=std(K);
0122     metZScores(metNGenes==sizes(i))=(metZScores(metNGenes==sizes(i))-mK)/stdK;
0123 <span class="keyword">end</span>
0124 
0125 <span class="comment">%Calculate the P-values</span>
0126 metPValues=1-normcdf(metZScores);
0127 
0128 <span class="comment">%Sort the results</span>
0129 [metZScores I]=sort(metZScores,<span class="string">'descend'</span>);
0130 mets=mets(I);
0131 metNames=metNames(I);
0132 metPValues=metPValues(I);
0133 metNGenes=metNGenes(I);
0134 meanZ=meanZ(I);
0135 stdZ=stdZ(I);
0136 
0137 <span class="comment">%Prepare the output</span>
0138 repMets.mets=mets;
0139 repMets.metNames=metNames;
0140 repMets.metZScores=metZScores;
0141 repMets.metPValues=metPValues;
0142 repMets.metNGenes=metNGenes;
0143 repMets.meanZ=meanZ;
0144 repMets.stdZ=stdZ;
0145 
0146 <span class="comment">%Call this function recursively if geneFoldChanges has been specified</span>
0147 repMets(1).test=<span class="string">'all'</span>;
0148 <span class="keyword">if</span> any(geneFoldChanges)
0149     repMets=[repMets;<a href="reporterMets.html" class="code" title="function repMets=reporterMets(model,genes,genePValues,printResults,outputFile,geneFoldChanges)">reporterMets</a>(model,genes(geneFoldChanges&gt;=0),genePValues(geneFoldChanges&gt;=0))];
0150     repMets=[repMets;<a href="reporterMets.html" class="code" title="function repMets=reporterMets(model,genes,genePValues,printResults,outputFile,geneFoldChanges)">reporterMets</a>(model,genes(geneFoldChanges&lt;0),genePValues(geneFoldChanges&lt;0))];
0151     repMets(2).test=<span class="string">'only up'</span>;
0152     repMets(3).test=<span class="string">'only down'</span>;
0153 <span class="keyword">end</span>
0154 
0155 <span class="comment">%This is for printing results to the screen. For printing a full list of</span>
0156 <span class="comment">%all scores, specify a output file</span>
0157 <span class="keyword">if</span> printResults==true
0158     <span class="keyword">for</span> i=1:numel(repMets)
0159         fprintf([<span class="string">'TOP 20 REPORTER METABOLITES\nTEST TYPE: '</span> repMets(i).test <span class="string">'\nID\tNAME\tP-VALUE\n'</span>]);
0160         <span class="keyword">for</span> j=1:min(20,numel(repMets(i).mets))
0161             fprintf([repMets(i).mets{j} <span class="string">'\t'</span> repMets(i).metNames{j} <span class="string">'\t'</span> num2str(repMets(i).metPValues(j)) <span class="string">'\n'</span>]);
0162         <span class="keyword">end</span>
0163         fprintf(<span class="string">'\n'</span>);
0164     <span class="keyword">end</span>
0165 <span class="keyword">end</span>
0166 
0167 <span class="comment">%Print results to file</span>
0168 <span class="keyword">if</span> any(outputFile)
0169     fid=fopen(outputFile,<span class="string">'w'</span>);
0170     <span class="keyword">for</span> i=1:numel(repMets)
0171         fprintf(fid,[<span class="string">'REPORTER METABOLITES USING TEST TYPE: '</span> repMets(i).test <span class="string">'\n'</span>]);
0172         fprintf(fid,<span class="string">'ID\tNAME\tZ-SCORE\tP-VALUE\tNUMBER OF NEIGHBOURS\tAVERAGE Z-SCORE\tSTD Z-SCORE\n'</span>);
0173         <span class="keyword">for</span> j=1:numel(repMets(i).mets)
0174             fprintf(fid,[repMets(i).mets{j} <span class="string">'\t'</span> repMets(i).metNames{j} <span class="string">'\t'</span> num2str(repMets(i).metZScores(j)) <span class="string">'\t'</span> num2str(repMets(i).metPValues(j)) <span class="string">'\t'</span> num2str(repMets(i).metNGenes(j)) <span class="string">'\t'</span> num2str(repMets(i).meanZ(j)) <span class="string">'\t'</span> num2str(repMets(i).stdZ(j)) <span class="string">'\n'</span>]);
0175         <span class="keyword">end</span>
0176     <span class="keyword">end</span>
0177     fclose(fid);
0178 <span class="keyword">end</span>
0179 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 06-Jan-2014 14:58:12 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>