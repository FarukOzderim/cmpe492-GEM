<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of drawPathway</title>
  <meta name="keywords" content="drawPathway">
  <meta name="description" content="drawPathway">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">RAVEN</a> &gt; drawPathway.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for RAVEN&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>drawPathway
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>drawPathway</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function drawPathway(pathway, handle, cutOff, defaultColor) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> drawPathway
    Draws a metabolic network to a figure.

   pathway         pathway structure representing the pathway to be drawn
   handle          handle to a figure (opt)
   cutOff          the fluxes are only printed if the absolute value of 
                   at least one of the fluxes is above the cutoff value
                   (opt, default 0)
   defaultColor    color in Matlab format to be used as the background
                   color for enzymes if no color is specified in the
                   pathway structure (opt, default [1 1 1])

   NOTE:   At the moment all text sizes and some positions are hard coded.
           This means that this code is not appliable for any map

   Usage: drawPathway(pathway, handle, cutOff, defaultColor)

   Rasmus Agren, 2012-03-26</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="getColorCodes.html" class="code" title="function [colorCodes signChange errorFlag]= getColorCodes(referenceFluxes, fluxes, maxChange, defaultColor, upColor, downColor)">getColorCodes</a>	getColorCodes</li><li><a href="getPathwayDimensions.html" class="code" title="function dimensions=getPathwayDimensions(pathway)">getPathwayDimensions</a>	getPathwayDimensions</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="drawMap.html" class="code" title="function notMapped=drawMap(title,pathway,modelA,conditionA,conditionB,modelB,filename,cutOff)">drawMap</a>	drawMap</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function handles = plotArrow( x1,y1,x2,y2,varargin )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function drawPathway(pathway, handle, cutOff, defaultColor)</a>
0002 <span class="comment">% drawPathway</span>
0003 <span class="comment">%    Draws a metabolic network to a figure.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   pathway         pathway structure representing the pathway to be drawn</span>
0006 <span class="comment">%   handle          handle to a figure (opt)</span>
0007 <span class="comment">%   cutOff          the fluxes are only printed if the absolute value of</span>
0008 <span class="comment">%                   at least one of the fluxes is above the cutoff value</span>
0009 <span class="comment">%                   (opt, default 0)</span>
0010 <span class="comment">%   defaultColor    color in Matlab format to be used as the background</span>
0011 <span class="comment">%                   color for enzymes if no color is specified in the</span>
0012 <span class="comment">%                   pathway structure (opt, default [1 1 1])</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%   NOTE:   At the moment all text sizes and some positions are hard coded.</span>
0015 <span class="comment">%           This means that this code is not appliable for any map</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%   Usage: drawPathway(pathway, handle, cutOff, defaultColor)</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%   Rasmus Agren, 2012-03-26</span>
0020 <span class="comment">%</span>
0021 
0022 <span class="keyword">if</span> nargin&lt;4
0023     defaultColor=[1 1 1];
0024 <span class="keyword">end</span>
0025 <span class="keyword">if</span> nargin&lt;3
0026     cutOff=0;
0027 <span class="keyword">end</span>
0028 <span class="keyword">if</span> nargin&lt;2
0029     handle=figure();
0030 <span class="keyword">else</span>
0031     figure(handle);
0032 <span class="keyword">end</span>
0033 
0034 <span class="comment">%Will contain all metabolite info and where to print them</span>
0035 metText={};
0036 metX=[];
0037 metY=[];
0038 metRec=[];
0039 
0040 <span class="comment">%Same for reaction text (names, fluxes and maybe other)</span>
0041 rxnText={};
0042 rxnX=[];
0043 rxnY=[];
0044 rxnLinesX=[];
0045 rxnLinesY=[];
0046 rxnRec=[];
0047 rxnFace=[];
0048 rxnEdge=[];
0049 rxnArrows=[];
0050 rxnArrowsColor=[];
0051 
0052 <span class="comment">%Expression boxes</span>
0053 expRec=[];
0054 expFace=[];
0055 
0056 <span class="comment">%Lines to enzymes</span>
0057 enzLinesX=[];
0058 enzLinesY=[];
0059 
0060 <span class="comment">%Same for compartments</span>
0061 compText={};
0062 compX=[];
0063 compY=[];
0064 compRec=[];
0065 
0066 <span class="comment">%Check if it should plot expression data</span>
0067 <span class="keyword">if</span> isfield(pathway.listOfSpecies(1),<span class="string">'orfs'</span>)
0068     drawExpression=true;
0069 <span class="keyword">else</span>
0070     drawExpression=false;
0071 <span class="keyword">end</span>
0072 
0073 <span class="comment">%Get the dimensions of the network</span>
0074 dimension=<a href="getPathwayDimensions.html" class="code" title="function dimensions=getPathwayDimensions(pathway)">getPathwayDimensions</a>(pathway);
0075 
0076 <span class="comment">%Specify the properties of the figure</span>
0077 set(gcf, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
0078 set(gcf, <span class="string">'Color'</span>, [1 1 1]);
0079 xmargin=0.83;
0080 ymargin=1.32;
0081 set(gcf, <span class="string">'PaperPosition'</span>, [xmargin ymargin 29.67743169791-2*xmargin 20.98404194812-2*ymargin]);
0082 set(gcf, <span class="string">'Renderer'</span>, <span class="string">'painters'</span>);
0083 set(gcf, <span class="string">'Position'</span>, [10 10 1000 700]);
0084 
0085 <span class="comment">%The height has to be at least the height of the information panel</span>
0086 <span class="comment">%(approximately 3000)</span>
0087 height=dimension(2)+dimension(4)+200;
0088 height=max(height,3000);
0089 
0090 axes(<span class="string">'ytick'</span>,[],<span class="string">'ydir'</span>,<span class="string">'reverse'</span>,<span class="string">'xtick'</span>,[],<span class="string">'ycolor'</span>,[1 1 1], <span class="string">'xcolor'</span>,<span class="keyword">...</span>
0091     [1 1 1],<span class="string">'position'</span>,[0 0 1 1], <span class="string">'xLim'</span>,[dimension(1)-40 dimension(1)+dimension(3)+800],<span class="keyword">...</span>
0092     <span class="string">'yLim'</span>, [dimension(2)-200 height]);
0093 daspect([1,1,1]);
0094 
0095 <span class="comment">%Loops through the compartments.</span>
0096 <span class="keyword">for</span> i=1:length(pathway.listOfCompartments)
0097     position=[pathway.listOfCompartments(1,i).x pathway.listOfCompartments(1,i).y<span class="keyword">...</span>
0098         pathway.listOfCompartments(1,i).w pathway.listOfCompartments(1,i).h];
0099     compRec=[compRec;position];
0100     compText=[compText;upper(pathway.listOfCompartments(i).name)];
0101     compX=[compX;position(1)+0.5*position(3)];
0102     compY=[compY;position(2)+position(4)-70];
0103 <span class="keyword">end</span>
0104 
0105 <span class="comment">%Get positions of lines</span>
0106 <span class="keyword">for</span> i=1:length(pathway.listOfReactions)
0107     <span class="keyword">for</span> j=1:length(pathway.listOfReactions(i).componentList)
0108         <span class="comment">%The line is always drawn from the middle to the component</span>
0109         middle=pathway.listOfReactions(i).middlePoint;
0110         x(1)=middle(1);
0111         y(1)=middle(2);
0112         x(2)=pathway.listOfReactions(i).componentList(j).anchor(1);
0113         y(2)=pathway.listOfReactions(i).componentList(j).anchor(2);
0114         
0115         <span class="comment">%Check to see if a line or an arrow should be drawn</span>
0116         <span class="keyword">if</span> strcmpi(pathway.listOfReactions(i).componentList(j).toArrow,<span class="string">'true'</span>)
0117             rxnArrows=[rxnArrows;x(1) y(1) x(2) y(2)];
0118             
0119             <span class="comment">%Draw a red arrow if it's a base product</span>
0120             <span class="keyword">if</span> strcmpi(pathway.listOfReactions(i).componentList(j).baseProduct,<span class="string">'true'</span>)
0121                 rxnArrowsColor=[rxnArrowsColor;1 0 0];
0122             <span class="keyword">else</span>
0123                 rxnArrowsColor=[rxnArrowsColor;0 0 0];
0124             <span class="keyword">end</span>
0125         <span class="keyword">else</span>
0126             <span class="comment">%If the component is an enzyme then a different line should be</span>
0127             <span class="comment">%used</span>
0128             <span class="keyword">if</span> strcmpi(pathway.listOfReactions(i).componentList(j).type,<span class="string">'ENZYME'</span>)
0129                 enzLinesX=[enzLinesX;x(1) x(2)];
0130                 enzLinesY=[enzLinesY;y(1) y(2)];
0131             <span class="keyword">else</span>
0132                 rxnLinesX=[rxnLinesX;x(1) x(2)];
0133                 rxnLinesY=[rxnLinesY;y(1) y(2)];
0134             <span class="keyword">end</span>
0135         <span class="keyword">end</span>
0136     <span class="keyword">end</span>
0137 <span class="keyword">end</span>
0138 
0139 <span class="comment">%Loops through the species</span>
0140 <span class="keyword">for</span> i=1:length(pathway.listOfSpecies)
0141     <span class="comment">%Species should be represented with ellipses and enzymes with</span>
0142     <span class="comment">%rectangles</span>
0143     position=[pathway.listOfSpecies(i).x pathway.listOfSpecies(i).y<span class="keyword">...</span>
0144             pathway.listOfSpecies(i).w pathway.listOfSpecies(i).h];
0145     <span class="keyword">if</span> strcmpi(pathway.listOfSpecies(i).type, <span class="string">'SIMPLE_MOLECULE'</span>)
0146         metRec=[metRec;position];
0147         metText=[metText;pathway.listOfSpecies(i).name];
0148         metX=[metX;position(1)+0.3*position(3)];
0149         metY=[metY;position(2)+0.5*position(4)];
0150     <span class="keyword">end</span>
0151     <span class="keyword">if</span> strcmpi(pathway.listOfSpecies(i).type, <span class="string">'PROTEIN'</span>)
0152         <span class="comment">%The color of the enzyme can be specified in the pathway object.</span>
0153         <span class="comment">%The default color is used if there is no 'color' field present.</span>
0154         <span class="comment">%If neither of the fluxes are above the cutoff value, then use the</span>
0155         <span class="comment">%default color</span>
0156         faceColor=defaultColor;
0157         <span class="keyword">if</span> isfield(pathway.listOfSpecies(i),<span class="string">'color'</span>)
0158             <span class="keyword">if</span> any(pathway.listOfSpecies(i).color)      
0159                 <span class="comment">%Check that the fluxes are specified</span>
0160                 <span class="keyword">if</span> isfield(pathway.listOfSpecies(i),<span class="string">'flux'</span>) &amp;&amp; isfield(pathway.listOfSpecies(i),<span class="string">'referenceFlux'</span>)
0161                     <span class="comment">%Check that the value of one of the fluxes is above the cutoff value</span>
0162                     <span class="keyword">if</span> abs(pathway.listOfSpecies(i).referenceFlux)&gt;=cutOff || abs(pathway.listOfSpecies(i).flux)&gt;=cutOff 
0163                         faceColor=pathway.listOfSpecies(i).color;
0164                     <span class="keyword">end</span>
0165                 <span class="keyword">end</span>
0166             <span class="keyword">end</span>
0167         <span class="keyword">end</span>
0168         
0169         <span class="comment">%If the reaction is associated with a sign change and either of the</span>
0170         <span class="comment">%fluxes are larger than the cutoff value, then use a different frame</span>
0171         edgeColor=[0 0 0];
0172         <span class="keyword">if</span> isfield(pathway.listOfSpecies(i),<span class="string">'signChange'</span>)
0173             <span class="keyword">if</span> any(pathway.listOfSpecies(i).signChange)
0174                 <span class="keyword">if</span> (pathway.listOfSpecies(i).signChange==true) &amp;&amp; (abs(pathway.listOfSpecies(i).referenceFlux)&gt;=cutOff || abs(pathway.listOfSpecies(i).flux)&gt;=cutOff)
0175                     edgeColor=[1 0.6 0.2];
0176                 <span class="keyword">end</span>
0177             <span class="keyword">end</span>
0178         <span class="keyword">end</span>
0179         
0180         rxnFace=[rxnFace;faceColor];
0181         rxnEdge=[rxnEdge;edgeColor];
0182         
0183         <span class="comment">%Draw smaller boxes if expression data should also be printed</span>
0184         <span class="keyword">if</span> drawExpression==true
0185             rxnRec=[rxnRec;position-[0 0 40 0]];
0186             
0187             <span class="comment">%Draw rectangles representing each gene. Max 8 circles are used.</span>
0188             <span class="comment">%Their width is hardcoded and so is the width of the area where</span>
0189             <span class="comment">%they are printed (40)</span>
0190             <span class="keyword">if</span> any(pathway.listOfSpecies(i).expA)
0191                 <span class="comment">%Calculate the position of the dots. 4 in each column.</span>
0192                 firstFourX=pathway.listOfSpecies(i).x+pathway.listOfSpecies(i).w-34;
0193                 fourY=pathway.listOfSpecies(i).y:pathway.listOfSpecies(i).h/4:pathway.listOfSpecies(i).y+pathway.listOfSpecies(i).h;
0194                 
0195                 nExp=numel(pathway.listOfSpecies(i).expA);
0196                 
0197                 <span class="comment">%One log10-fold change is total up or down</span>
0198                 colorCodes=<a href="getColorCodes.html" class="code" title="function [colorCodes signChange errorFlag]= getColorCodes(referenceFluxes, fluxes, maxChange, defaultColor, upColor, downColor)">getColorCodes</a>(pathway.listOfSpecies(i).expA, pathway.listOfSpecies(i).expB);
0199 
0200                 <span class="comment">%Plot the circles</span>
0201                 <span class="keyword">for</span> j=1:min(nExp,4)
0202                     expRec=[expRec;firstFourX fourY(j) 16 pathway.listOfSpecies(i).h/4];
0203                     expFace=[expFace;colorCodes{j}];
0204                 <span class="keyword">end</span>
0205                 
0206                 <span class="comment">%If a second row is needed</span>
0207                 <span class="keyword">if</span> nExp&gt;4
0208                     secondFourX=pathway.listOfSpecies(i).x+pathway.listOfSpecies(i).w-16;
0209                     <span class="keyword">for</span> j=5:min(nExp,8)
0210                         expRec=[expRec;secondFourX fourY(j-4) 16 pathway.listOfSpecies(i).h/4];
0211                         expFace=[expFace;colorCodes{j}];
0212                     <span class="keyword">end</span>
0213                 <span class="keyword">end</span>
0214             <span class="keyword">end</span>
0215         <span class="keyword">else</span>
0216             rxnRec=[rxnRec;position];
0217         <span class="keyword">end</span>
0218         
0219         <span class="comment">%If no fluxes are specified then should only the name be printed.</span>
0220         <span class="comment">%Flux values should only be printed if at least one of the fluxes</span>
0221         <span class="comment">%is above the cutoff value</span>
0222         textToPrint={};
0223         
0224         <span class="comment">%NOTE:  This is done since I know that I have names including '_' which is a reserved</span>
0225         <span class="comment">%       character in LaTeX. This should be done more systematically</span>
0226         
0227         <span class="comment">%NOTE:  The notation used means that only flux values with with less than</span>
0228         <span class="comment">%       nine characters can be used</span>
0229         
0230         textToPrint{1,1}=strrep(pathway.listOfSpecies(i).name,<span class="string">'_'</span>,<span class="string">'\_'</span>);
0231         
0232         <span class="comment">%Check that the fluxes are specified</span>
0233         <span class="comment">%NOTE: Should you only print if there are two fluxes?</span>
0234         <span class="keyword">if</span> isfield(pathway.listOfSpecies(i),<span class="string">'flux'</span>) &amp;&amp; isfield(pathway.listOfSpecies(i),<span class="string">'referenceFlux'</span>)
0235             <span class="comment">%Check that the value of one of the fluxes is above the cutoff value</span>
0236             <span class="keyword">if</span> ~isempty(pathway.listOfSpecies(i).flux) &amp;&amp; ~isempty(pathway.listOfSpecies(i).referenceFlux)
0237                 <span class="keyword">if</span> abs(pathway.listOfSpecies(i).referenceFlux)&gt;=cutOff || abs(pathway.listOfSpecies(i).flux)&gt;=cutOff 
0238                     textToPrint{2,1}=num2str(pathway.listOfSpecies(i).flux,<span class="string">'%0.4g'</span>);
0239                     textToPrint{3,1}=num2str(pathway.listOfSpecies(i).referenceFlux,<span class="string">'%0.4g'</span>);
0240                 <span class="keyword">end</span>
0241             <span class="keyword">end</span>
0242         <span class="keyword">end</span>
0243 
0244         xPos=ones(numel(textToPrint),1)*(position(1)+3);
0245         distance=position(4)/(numel(textToPrint)+1);
0246         yPos=position(2)+distance:distance:(position(2)+position(4)-distance);
0247         
0248         rxnText=[rxnText;textToPrint];
0249         rxnX=[rxnX;xPos];
0250         rxnY=[rxnY;yPos'];
0251     <span class="keyword">end</span>
0252 <span class="keyword">end</span>
0253 
0254 <span class="comment">%*** Print everything ***</span>
0255 
0256 <span class="comment">%Compartment rectangles</span>
0257 <span class="keyword">for</span> i=1:size(compRec,1)
0258     rectangle(<span class="string">'edgecolor'</span>,[1 0.8 0.2], <span class="string">'facecolor'</span>, [1 0.91 0.55], <span class="string">'linewidth'</span>, 2, <span class="string">'curvature'</span>, [0.05 0.05],<span class="keyword">...</span>
0259         <span class="string">'position'</span>,compRec(i,:));
0260     rectangle(<span class="string">'edgecolor'</span>,[1 0.8 0.2], <span class="string">'facecolor'</span>, [1 1 1], <span class="string">'linewidth'</span>, 1, <span class="string">'curvature'</span>, [0.05 0.05],<span class="keyword">...</span>
0261         <span class="string">'position'</span>,compRec(i,:)+[12 12 -24 -24]);
0262 <span class="keyword">end</span>
0263 
0264 <span class="comment">%Reaction lines</span>
0265 line(rxnLinesX',rxnLinesY',<span class="string">'linewidth'</span>,0.1,<span class="string">'color'</span>,[0 0 0]);
0266 
0267 <span class="comment">%Arrow lines</span>
0268 hold on;
0269 <span class="keyword">for</span> i=1:size(rxnArrows,1)
0270     <a href="#_sub1" class="code" title="subfunction handles = plotArrow( x1,y1,x2,y2,varargin )">plotArrow</a>(rxnArrows(i,1),rxnArrows(i,2),rxnArrows(i,3),rxnArrows(i,4),<span class="string">'linewidth'</span>,0.1,<span class="string">'edgecolor'</span>,rxnArrowsColor(i,:),<span class="string">'facecolor'</span>,rxnArrowsColor(i,:));
0271 <span class="keyword">end</span>
0272 hold off;
0273 
0274 <span class="comment">%Enzyme lines</span>
0275 line(enzLinesX',enzLinesY',<span class="string">'marker'</span>,<span class="string">'o'</span>,<span class="string">'markeredgecolor'</span>,[0 0 0],<span class="string">'markersize'</span>,0.5,<span class="keyword">...</span>
0276     <span class="string">'markerfacecolor'</span>,[1 0.969 0.922],<span class="string">'linewidth'</span>,0.1,<span class="string">'color'</span>,[0 0 0]);
0277 
0278 <span class="comment">%Metabolite rectangles</span>
0279 <span class="keyword">for</span> i=1:size(metRec,1)
0280     rectangle(<span class="string">'edgecolor'</span>, [0 0 0], <span class="string">'facecolor'</span>, [1 1 0.78], <span class="string">'curvature'</span>, [0.8 0.8],<span class="keyword">...</span>
0281                 <span class="string">'position'</span>,metRec(i,:),<span class="string">'linewidth'</span>,0.1);
0282 <span class="keyword">end</span>
0283 
0284 <span class="comment">%Reaction rectangles</span>
0285 <span class="keyword">for</span> i=1:size(rxnRec,1)
0286     rectangle(<span class="string">'edgecolor'</span>, rxnEdge(i,:), <span class="string">'facecolor'</span>, rxnFace(i,:), <span class="string">'linewidth'</span>,0.1,<span class="keyword">...</span>
0287         <span class="string">'curvature'</span>, [0.1 0.1], <span class="string">'position'</span>,rxnRec(i,:));  
0288 <span class="keyword">end</span>
0289 
0290 <span class="comment">%Expression rectangles</span>
0291 <span class="keyword">for</span> i=1:size(expRec,1)
0292     rectangle(<span class="string">'facecolor'</span>, expFace(i,:), <span class="string">'linewidth'</span>,0.1, <span class="string">'curvature'</span>, [0.1 0.1],<span class="keyword">...</span>
0293         <span class="string">'position'</span>,expRec(i,:));
0294 <span class="keyword">end</span>
0295 
0296 <span class="comment">%Metabolite text</span>
0297 <span class="comment">%Temporary thing to get it right for small networks as well. Should be</span>
0298 <span class="comment">%calculated better!</span>
0299 <span class="keyword">if</span> dimension(3)&lt;5000
0300     textSize=3;
0301 <span class="keyword">else</span>
0302     textSize=0.5;
0303 <span class="keyword">end</span>
0304 
0305 text(metX,metY,metText,<span class="string">'fontname'</span>,<span class="string">'Small Fonts'</span>,<span class="string">'fontsize'</span>,textSize,<span class="string">'interpreter'</span>,<span class="string">'tex'</span>,<span class="keyword">...</span>
0306     <span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="string">'verticalalignment'</span>,<span class="string">'middle'</span>);
0307 
0308 <span class="comment">%Reaction text</span>
0309 text(rxnX,rxnY,rxnText,<span class="string">'fontname'</span>,<span class="string">'Small Fonts'</span>,<span class="string">'fontsize'</span>,textSize,<span class="string">'interpreter'</span>,<span class="string">'tex'</span>,<span class="keyword">...</span>
0310     <span class="string">'verticalalignment'</span>,<span class="string">'middle'</span>,<span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>);
0311 
0312 <span class="comment">%Compartment text. The text is centered and at the bottom of the compartment</span>
0313 text(compX, compY,compText,<span class="string">'fontname'</span>,<span class="string">'Small Fonts'</span>,<span class="string">'fontsize'</span>,7,<span class="string">'interpreter'</span>,<span class="string">'none'</span>,<span class="keyword">...</span>
0314     <span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="string">'verticalalignment'</span>,<span class="string">'middle'</span>);      
0315 <span class="keyword">end</span>
0316 
0317 <a name="_sub1" href="#_subfunctions" class="code">function handles = plotArrow( x1,y1,x2,y2,varargin )</a>
0318 <span class="comment">%</span>
0319 <span class="comment">% plotArrow - plots an arrow to the current plot</span>
0320 <span class="comment">%</span>
0321 <span class="comment">% format:   handles = plotArrow( x1,y1,x2,y2 [,options...] )</span>
0322 <span class="comment">%</span>
0323 <span class="comment">% input:    x1,y1   - starting point</span>
0324 <span class="comment">%           x2,y2   - end point</span>
0325 <span class="comment">%           options - come as pairs of &quot;property&quot;,&quot;value&quot; as defined for &quot;line&quot; and &quot;patch&quot;</span>
0326 <span class="comment">%                     controls, see matlab help for listing of these properties.</span>
0327 <span class="comment">%                     note that not all properties where added, one might add them at the end of this file.</span>
0328 <span class="comment">%</span>
0329 <span class="comment">%                     additional options are:</span>
0330 <span class="comment">%                     'headwidth':  relative to complete arrow size, default value is 0.07</span>
0331 <span class="comment">%                     'headheight': relative to complete arrow size, default value is 0.15</span>
0332 <span class="comment">%                     (encoded are maximal values if pixels, for the case that the arrow is very long)</span>
0333 <span class="comment">%</span>
0334 <span class="comment">% output:   handles - handles of the graphical elements building the arrow</span>
0335 <span class="comment">%</span>
0336 <span class="comment">% Example:  plotArrow( -1,-1,15,12,'linewidth',2,'color',[0.5 0.5 0.5],'facecolor',[0.5 0.5 0.5] );</span>
0337 <span class="comment">%           plotArrow( 0,0,5,4,'linewidth',2,'headwidth',0.25,'headheight',0.33 );</span>
0338 <span class="comment">%           plotArrow;   % will launch demo</span>
0339 
0340 <span class="comment">% =============================================</span>
0341 <span class="comment">% constants (can be edited)</span>
0342 <span class="comment">% =============================================</span>
0343 <span class="comment">%NOTE: These should be 100 times smaller</span>
0344 alpha       = 15;   <span class="comment">% head length</span>
0345 beta        = 7;   <span class="comment">% head width</span>
0346 max_length  = 11;
0347 max_width   = 7;
0348 
0349 <span class="comment">% =============================================</span>
0350 <span class="comment">% check if head properties are given</span>
0351 <span class="comment">% =============================================</span>
0352 <span class="comment">% if ratio is always fixed, this section can be removed!</span>
0353 <span class="keyword">if</span> ~isempty( varargin )
0354     <span class="keyword">for</span> c = 1:floor(length(varargin)/2)
0355         <span class="keyword">switch</span> lower(varargin{c*2-1})
0356             <span class="comment">% head properties - do nothing, since handled above already</span>
0357         <span class="keyword">case</span> <span class="string">'headheight'</span>,alpha = max( min( varargin{c*2},1 ),0.01 );
0358         <span class="keyword">case</span> <span class="string">'headwidth'</span>, beta = max( min( varargin{c*2},1 ),0.01 );
0359         <span class="keyword">end</span>
0360     <span class="keyword">end</span>
0361 <span class="keyword">end</span>
0362 
0363 <span class="comment">% =============================================</span>
0364 <span class="comment">% calculate the arrow head coordinates</span>
0365 <span class="comment">% =============================================</span>
0366 den         = x2 - x1 + eps;                                <span class="comment">% make sure no devision by zero occurs</span>
0367 teta        = atan( (y2-y1)/den ) + pi*(x2&lt;x1) - pi/2;      <span class="comment">% angle of arrow</span>
0368 cs          = cos(teta);                                    <span class="comment">% rotation matrix</span>
0369 ss          = sin(teta);
0370 R           = [cs -ss;ss cs];
0371 line_length = sqrt( (y2-y1)^2 + (x2-x1)^2 );                <span class="comment">% sizes</span>
0372 head_length = min( line_length*alpha,max_length );
0373 head_width  = min( line_length*beta,max_length );
0374 x0          = x2*cs + y2*ss;                                <span class="comment">% build head coordinats</span>
0375 y0          = -x2*ss + y2*cs;
0376 coords      = R*[x0 x0+head_width/2 x0-head_width/2; y0 y0-head_length y0-head_length];
0377 
0378 <span class="comment">% =============================================</span>
0379 <span class="comment">% plot arrow  (= line + patch of a triangle)</span>
0380 <span class="comment">% =============================================</span>
0381 h1          = plot( [x1,x2],[y1,y2],<span class="string">'k'</span> );
0382 h2          = patch( coords(1,:),coords(2,:),[0 0 0] );
0383     
0384 <span class="comment">% =============================================</span>
0385 <span class="comment">% return handles</span>
0386 <span class="comment">% =============================================</span>
0387 handles = [h1 h2];
0388 
0389 <span class="comment">% =============================================</span>
0390 <span class="comment">% check if styling is required</span>
0391 <span class="comment">% =============================================</span>
0392 <span class="comment">% if no styling, this section can be removed!</span>
0393 <span class="keyword">if</span> ~isempty( varargin )
0394     <span class="keyword">for</span> c = 1:floor(length(varargin)/2)
0395         <span class="keyword">switch</span> lower(varargin{c*2-1})
0396 
0397          <span class="comment">% only patch properties</span>
0398         <span class="keyword">case</span> <span class="string">'edgecolor'</span>,   set( h2,<span class="string">'EdgeColor'</span>,varargin{c*2} );
0399         <span class="keyword">case</span> <span class="string">'facecolor'</span>,   set( h2,<span class="string">'FaceColor'</span>,varargin{c*2} );
0400         <span class="keyword">case</span> <span class="string">'facelighting'</span>,set( h2,<span class="string">'FaceLighting'</span>,varargin{c*2} );
0401         <span class="keyword">case</span> <span class="string">'edgelighting'</span>,set( h2,<span class="string">'EdgeLighting'</span>,varargin{c*2} );
0402 
0403         <span class="comment">% only line properties</span>
0404         <span class="keyword">case</span> <span class="string">'color'</span>    , set( h1,<span class="string">'Color'</span>,varargin{c*2} );
0405 
0406         <span class="comment">% shared properties</span>
0407         <span class="keyword">case</span> <span class="string">'linestyle'</span>, set( handles,<span class="string">'LineStyle'</span>,varargin{c*2} );
0408         <span class="keyword">case</span> <span class="string">'linewidth'</span>, set( handles,<span class="string">'LineWidth'</span>,varargin{c*2} );
0409         <span class="keyword">case</span> <span class="string">'parent'</span>,    set( handles,<span class="string">'parent'</span>,varargin{c*2} );
0410 
0411         <span class="comment">% head properties - do nothing, since handled above already</span>
0412         <span class="keyword">case</span> <span class="string">'headwidth'</span>,;
0413         <span class="keyword">case</span> <span class="string">'headheight'</span>,;
0414 
0415         <span class="keyword">end</span>
0416     <span class="keyword">end</span>
0417 <span class="keyword">end</span>
0418 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 06-Jan-2014 14:58:12 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>