<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of fitParameters</title>
  <meta name="keywords" content="fitParameters">
  <meta name="description" content="fitParameters">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">RAVEN</a> &gt; fitParameters.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for RAVEN&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>fitParameters
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>fitParameters</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [parameters fitnessScore exitFlag newModel]=fitParameters(model,xRxns,xValues,rxnsToFit,valuesToFit,parameterPositions,fitToRatio,initialGuess,plotFitting) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> fitParameters
   Fits parameters such as maintenance ATP by quadratic programming

   model                 a model structure
   xRxns                 cell array with the IDs of the reactions that will be fixed for each data point
   xValues               matrix with the corresponding values for each
                         xRxns (columns are reactions)
   rxnsToFit             cell array with the IDs of reactions that will be fitted to
   valuesToFit           matrix with the corresponding values for each 
                         rxnsToFit (columns are reactions)
   parameterPositions    stucture that determines where the parameters are in the
                         stoichiometric matrix. Contains the fields:
       position          cell array of vectors where each element contains
                         the positions in the S-matrix for that parameter
       isNegative        cell array of vectors where the elements are true
                         if that position should be the negative of the
                         fitted value (to differentiate between
                         production/consumption)
    fitToRatio            if the ratio of simulated to measured values should
                         be fitted instead of the absolute value. Used to prevent 
                         large fluxes from having too large impact (opt,
                         default true)
   initialGuess          initial guess of the parameters (opt)
   plotFitting           true if the resulting fitting should be plotted
                         (opt, default false)

   parameters            fitted parameters in the same order as in
                         parameterPositions
   fitnessScore          the correponding residual sum of squares
   newModel              updated model structure with the fitted parameters

   Usage: [parameters fitnessScore exitFlag newModel]=fitParameters(model,...
           xRxns,xValues,rxnsToFit,valuesToFit,parameterPositions,fitToRatio,...
           initialGuess,plotFitting)

   Rasmus Agren, 2013-08-01</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>	dispEM</li><li><a href="solveLP.html" class="code" title="function [solution hsSolOut]=solveLP(model,minFlux,params,hsSol)">solveLP</a>	solveLP</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [rss resultingFluxes newModel]=getRSS(parameters,model,xRxnsIndexes,xValues,rxnsToFitIndexes,valuesToFit,parameterPositions,fitToRatio)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [parameters fitnessScore exitFlag newModel]=fitParameters(model,xRxns,xValues,rxnsToFit,valuesToFit,parameterPositions,fitToRatio,initialGuess,plotFitting)</a>
0002 <span class="comment">% fitParameters</span>
0003 <span class="comment">%   Fits parameters such as maintenance ATP by quadratic programming</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   model                 a model structure</span>
0006 <span class="comment">%   xRxns                 cell array with the IDs of the reactions that will be fixed for each data point</span>
0007 <span class="comment">%   xValues               matrix with the corresponding values for each</span>
0008 <span class="comment">%                         xRxns (columns are reactions)</span>
0009 <span class="comment">%   rxnsToFit             cell array with the IDs of reactions that will be fitted to</span>
0010 <span class="comment">%   valuesToFit           matrix with the corresponding values for each</span>
0011 <span class="comment">%                         rxnsToFit (columns are reactions)</span>
0012 <span class="comment">%   parameterPositions    stucture that determines where the parameters are in the</span>
0013 <span class="comment">%                         stoichiometric matrix. Contains the fields:</span>
0014 <span class="comment">%       position          cell array of vectors where each element contains</span>
0015 <span class="comment">%                         the positions in the S-matrix for that parameter</span>
0016 <span class="comment">%       isNegative        cell array of vectors where the elements are true</span>
0017 <span class="comment">%                         if that position should be the negative of the</span>
0018 <span class="comment">%                         fitted value (to differentiate between</span>
0019 <span class="comment">%                         production/consumption)</span>
0020 <span class="comment">%    fitToRatio            if the ratio of simulated to measured values should</span>
0021 <span class="comment">%                         be fitted instead of the absolute value. Used to prevent</span>
0022 <span class="comment">%                         large fluxes from having too large impact (opt,</span>
0023 <span class="comment">%                         default true)</span>
0024 <span class="comment">%   initialGuess          initial guess of the parameters (opt)</span>
0025 <span class="comment">%   plotFitting           true if the resulting fitting should be plotted</span>
0026 <span class="comment">%                         (opt, default false)</span>
0027 <span class="comment">%</span>
0028 <span class="comment">%   parameters            fitted parameters in the same order as in</span>
0029 <span class="comment">%                         parameterPositions</span>
0030 <span class="comment">%   fitnessScore          the correponding residual sum of squares</span>
0031 <span class="comment">%   newModel              updated model structure with the fitted parameters</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%   Usage: [parameters fitnessScore exitFlag newModel]=fitParameters(model,...</span>
0034 <span class="comment">%           xRxns,xValues,rxnsToFit,valuesToFit,parameterPositions,fitToRatio,...</span>
0035 <span class="comment">%           initialGuess,plotFitting)</span>
0036 <span class="comment">%</span>
0037 <span class="comment">%   Rasmus Agren, 2013-08-01</span>
0038 <span class="comment">%</span>
0039 
0040 <span class="keyword">if</span> nargin&lt;7
0041     fitToRatio=true;
0042 <span class="keyword">end</span>
0043 <span class="keyword">if</span> nargin&lt;8
0044     initialGuess=ones(numel(parameterPositions.position),1);
0045 <span class="keyword">end</span>
0046 <span class="keyword">if</span> isempty(initialGuess)
0047     initialGuess=ones(numel(parameterPositions.position),1);
0048 <span class="keyword">end</span>
0049 <span class="keyword">if</span> nargin&lt;9
0050     plotFitting=false;
0051 <span class="keyword">end</span>
0052 
0053 <span class="comment">%Find the indexes of reactions that will be fitted</span>
0054 [I rxnsToFitIndexes]=ismember(rxnsToFit,model.rxns);
0055 
0056 <span class="keyword">if</span> ~all(I)
0057     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'Could not find all reactions in rxnsToFit'</span>);
0058 <span class="keyword">end</span>
0059 
0060 <span class="comment">%Find the indexes of reactions that will be used for constraints.</span>
0061 [I xRxnsIndexes]=ismember(xRxns,model.rxns);
0062 
0063 <span class="keyword">if</span> ~all(I)
0064     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'Could not find all reactions in xRxns'</span>);
0065 <span class="keyword">end</span>
0066 
0067 [parameters fitnessScore exitFlag]=fminsearch(@(parameters) <a href="#_sub1" class="code" title="subfunction [rss resultingFluxes newModel]=getRSS(parameters,model,xRxnsIndexes,xValues,rxnsToFitIndexes,valuesToFit,parameterPositions,fitToRatio)">getRSS</a>(parameters,model,xRxnsIndexes,xValues,rxnsToFitIndexes,valuesToFit,parameterPositions,fitToRatio),initialGuess);
0068 
0069 parameters=abs(parameters);
0070 
0071 <span class="keyword">if</span> plotFitting==true
0072     <span class="comment">%Set the resulting parameters</span>
0073     [rss resultingFluxes newModel]=<a href="#_sub1" class="code" title="subfunction [rss resultingFluxes newModel]=getRSS(parameters,model,xRxnsIndexes,xValues,rxnsToFitIndexes,valuesToFit,parameterPositions,fitToRatio)">getRSS</a>(parameters,model,xRxnsIndexes,xValues,rxnsToFitIndexes,valuesToFit,parameterPositions,true);
0074     plot(xValues,valuesToFit,<span class="string">'o'</span>,xValues,resultingFluxes,<span class="string">'-*'</span>);
0075 <span class="keyword">end</span>
0076 <span class="keyword">end</span>
0077 
0078 <a name="_sub1" href="#_subfunctions" class="code">function [rss resultingFluxes newModel]=getRSS(parameters,model,xRxnsIndexes,xValues,rxnsToFitIndexes,valuesToFit,parameterPositions,fitToRatio)</a>
0079 parameters=abs(parameters);
0080 
0081 <span class="comment">%Set the parameters at the positions specified in parameterPositions</span>
0082 <span class="keyword">for</span> i=1:numel(parameterPositions.position)
0083     <span class="comment">%Set positive</span>
0084     model.S(parameterPositions.position{i}(parameterPositions.isNegative{i}==false))=parameters(i);
0085     
0086     <span class="comment">%Set negative</span>
0087     model.S(parameterPositions.position{i}(parameterPositions.isNegative{i}==true))=parameters(i)*-1;
0088 <span class="keyword">end</span>
0089 
0090 <span class="comment">%Also return an updated model</span>
0091 newModel=model;
0092 
0093 <span class="comment">%Loop through each data point, set xRxns to xValues and calculate the sum</span>
0094 <span class="comment">%of squares for the rxnsToFit</span>
0095 rss=0;
0096 resultingFluxes=[];
0097 <span class="keyword">for</span> i=1:size(xValues,1)
0098     <span class="comment">%Fix for more xRxns!</span>
0099     model.lb(xRxnsIndexes)=xValues(i,:);
0100     model.ub(xRxnsIndexes)=xValues(i);
0101     
0102     sol=<a href="solveLP.html" class="code" title="function [solution hsSolOut]=solveLP(model,minFlux,params,hsSol)">solveLP</a>(model);
0103     
0104     <span class="comment">%Calculate the rss</span>
0105     <span class="keyword">if</span> fitToRatio==false
0106         rs=sol.x(rxnsToFitIndexes)'-valuesToFit(i,:);
0107     <span class="keyword">else</span>
0108         rs=sol.x(rxnsToFitIndexes)'./valuesToFit(i,:)-ones(1,size(valuesToFit,2));
0109     <span class="keyword">end</span>
0110     rss=rss+rs*rs';
0111     resultingFluxes=[resultingFluxes sol.x(rxnsToFitIndexes)];
0112 <span class="keyword">end</span>
0113 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 06-Jan-2014 14:58:12 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>