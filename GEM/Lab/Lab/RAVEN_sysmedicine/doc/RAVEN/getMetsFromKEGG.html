<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getMetsFromKEGG</title>
  <meta name="keywords" content="getMetsFromKEGG">
  <meta name="description" content="getMetsFromKEGG">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">RAVEN</a> &gt; getMetsFromKEGG.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for RAVEN&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>getMetsFromKEGG
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>getMetsFromKEGG</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function model=getMetsFromKEGG(keggPath) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> getMetsFromKEGG
   Retrieves information on all metabolites stored in KEGG database

   keggPath    this function reads data from a local FTP dump of the KEGG
               database. keggPath is the pathway to the root of the database

   model       a model structure generated from the database. The following
               fields are filled
               id:             'KEGG'
               description:    'Automatically generated from KEGG database'
               mets:           KEGG compound ids
               metNames:       Compound name. Only the first name will be
                               saved if there are several synonyms
               metMiriams:     If there is a CHEBI id available, then that
                               will be saved here
               inchis:         InChI string for the metabolite
               metFormulas:    The chemical composition of the metabolite.
                               This will only be loaded if there is no InChI 
                               string
   If the file keggMets.mat is in the RAVEN directory it will be loaded 
   instead of parsing of the KEGG files. If it does not exist it will be 
   saved after parsing of the KEGG files. In general, you should remove the
   keggMets.mat file if you want to rebuild the model structure from a
   newer version of KEGG.
               
   Usage: model=getMetsFromKEGG(keggPath)

   Rasmus Agren, 2013-08-01</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>	dispEM</li><li><a href="downloadKEGG.html" class="code" title="function exitFlag=downloadKEGG(keggPath)">downloadKEGG</a>	downloadKEGG</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="getModelFromKEGG.html" class="code" title="function [model KOModel]=getModelFromKEGG(keggPath,keepUndefinedStoich,keepIncomplete,keepGeneral)">getModelFromKEGG</a>	getModelFromKEGG</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function model=getMetsFromKEGG(keggPath)</a>
0002 <span class="comment">% getMetsFromKEGG</span>
0003 <span class="comment">%   Retrieves information on all metabolites stored in KEGG database</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   keggPath    this function reads data from a local FTP dump of the KEGG</span>
0006 <span class="comment">%               database. keggPath is the pathway to the root of the database</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%   model       a model structure generated from the database. The following</span>
0009 <span class="comment">%               fields are filled</span>
0010 <span class="comment">%               id:             'KEGG'</span>
0011 <span class="comment">%               description:    'Automatically generated from KEGG database'</span>
0012 <span class="comment">%               mets:           KEGG compound ids</span>
0013 <span class="comment">%               metNames:       Compound name. Only the first name will be</span>
0014 <span class="comment">%                               saved if there are several synonyms</span>
0015 <span class="comment">%               metMiriams:     If there is a CHEBI id available, then that</span>
0016 <span class="comment">%                               will be saved here</span>
0017 <span class="comment">%               inchis:         InChI string for the metabolite</span>
0018 <span class="comment">%               metFormulas:    The chemical composition of the metabolite.</span>
0019 <span class="comment">%                               This will only be loaded if there is no InChI</span>
0020 <span class="comment">%                               string</span>
0021 <span class="comment">%   If the file keggMets.mat is in the RAVEN directory it will be loaded</span>
0022 <span class="comment">%   instead of parsing of the KEGG files. If it does not exist it will be</span>
0023 <span class="comment">%   saved after parsing of the KEGG files. In general, you should remove the</span>
0024 <span class="comment">%   keggMets.mat file if you want to rebuild the model structure from a</span>
0025 <span class="comment">%   newer version of KEGG.</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%   Usage: model=getMetsFromKEGG(keggPath)</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%   Rasmus Agren, 2013-08-01</span>
0030 <span class="comment">%</span>
0031 
0032 <span class="comment">%NOTE: This is how one entry looks in the file</span>
0033 
0034 <span class="comment">% ENTRY       C00001                      Compound</span>
0035 <span class="comment">% NAME        H2O;</span>
0036 <span class="comment">%             Water</span>
0037 <span class="comment">% FORMULA     H2O</span>
0038 <span class="comment">% MASS        18.0106</span>
0039 <span class="comment">% REMARK      Same as: D00001</span>
0040 <span class="comment">% REACTION    R00001 R00002 R00004 R00005 R00009 R00010 R00011 R00017</span>
0041 <span class="comment">%             R00022 R00024 R00026 R00028 R00036 R00041 R00044 R00045</span>
0042 <span class="comment">% ENZYME      1.1.1.160</span>
0043 <span class="comment">% DBLINKS     PubChem: 7435</span>
0044 <span class="comment">%             ChEBI: 29110</span>
0045 
0046 <span class="comment">%Then a lot of info about the positions of the atoms and so on. It is not</span>
0047 <span class="comment">%certain that each metabolite follows this structure exactly</span>
0048 
0049 <span class="comment">%The file is not tab-delimited. Instead each label is 12 characters</span>
0050 <span class="comment">%(except for '///')</span>
0051 
0052 <span class="comment">%Check if the reactions have been parsed before and saved. If so, load the</span>
0053 <span class="comment">%model.</span>
0054 [ST I]=dbstack(<span class="string">'-completenames'</span>);
0055 ravenPath=fileparts(ST(I).file);
0056 metsFile=fullfile(ravenPath,<span class="string">'kegg'</span>,<span class="string">'keggMets.mat'</span>);
0057 <span class="keyword">if</span> exist(metsFile, <span class="string">'file'</span>)
0058     fprintf([<span class="string">'NOTE: Importing KEGG metabolites from '</span> strrep(metsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">'.\n'</span>]);
0059     load(metsFile);
0060 <span class="keyword">else</span>
0061     <span class="comment">%Download required files from KEGG if it doesn't exist in the directory</span>
0062     <a href="downloadKEGG.html" class="code" title="function exitFlag=downloadKEGG(keggPath)">downloadKEGG</a>(keggPath);
0063     
0064     <span class="comment">%Add new functionality in the order specified in models</span>
0065     model.id=<span class="string">'KEGG'</span>;
0066     model.description=<span class="string">'Automatically generated from KEGG database'</span>;
0067 
0068     <span class="comment">%Preallocate memory for 20000 metabolites</span>
0069     model.mets=cell(20000,1);
0070     model.metNames=cell(20000,1);
0071     model.metFormulas=cell(20000,1);
0072     model.metMiriams=cell(20000,1);
0073 
0074     <span class="comment">%First load information on metabolite ID, metabolite name, composition, and</span>
0075     <span class="comment">%CHEBI</span>
0076     fid = fopen(fullfile(keggPath,<span class="string">'compound'</span>), <span class="string">'r'</span>);
0077 
0078     <span class="comment">%Keeps track of how many metabolites that have been added</span>
0079     metCounter=0;
0080 
0081     <span class="comment">%Loop through the file</span>
0082     <span class="keyword">while</span> 1
0083       <span class="comment">%Get the next line</span>
0084       tline = fgetl(fid);
0085 
0086       <span class="comment">%Abort at end of file</span>
0087       <span class="keyword">if</span> ~ischar(tline)
0088           <span class="keyword">break</span>;
0089       <span class="keyword">end</span>
0090 
0091       <span class="comment">%Skip '///'</span>
0092       <span class="keyword">if</span> numel(tline)&lt;12
0093           <span class="keyword">continue</span>;
0094       <span class="keyword">end</span>
0095 
0096       <span class="comment">%Check if it's a new reaction</span>
0097       <span class="keyword">if</span> strcmp(tline(1:12),<span class="string">'ENTRY       '</span>)
0098           metCounter=metCounter+1;
0099 
0100           <span class="comment">%Add empty strings where there should be such</span>
0101           model.metNames{metCounter}=<span class="string">''</span>;
0102           model.metFormulas{metCounter}=<span class="string">''</span>;
0103 
0104           <span class="comment">%Add compound ID (always 6 characters)</span>
0105           model.mets{metCounter}=tline(13:18);
0106       <span class="keyword">end</span>
0107 
0108       <span class="comment">%Add name</span>
0109       <span class="keyword">if</span> strcmp(tline(1:12),<span class="string">'NAME        '</span>)
0110           <span class="comment">%If there are synonyms, then the last character is ';'</span>
0111           <span class="keyword">if</span> strcmp(tline(end),<span class="string">';'</span>)
0112                 model.metNames{metCounter}=tline(13:end-1);
0113           <span class="keyword">else</span>
0114                 model.metNames{metCounter}=tline(13:end);
0115           <span class="keyword">end</span>
0116       <span class="keyword">end</span>
0117 
0118       <span class="comment">%Add composition</span>
0119       <span class="keyword">if</span> strcmp(tline(1:12),<span class="string">'FORMULA     '</span>)
0120           model.metFormulas{metCounter}=tline(13:end);
0121       <span class="keyword">end</span>
0122 
0123       <span class="comment">%Add CHEBI id</span>
0124       <span class="keyword">if</span> numel(tline)&gt;19
0125           <span class="keyword">if</span> strcmp(tline(1:19),<span class="string">'            ChEBI: '</span>)
0126               chebiID=tline(20:end); <span class="comment">%This is because there is sometimes more then one CHEBI index</span>
0127 
0128               <span class="comment">%Only load one id for now</span>
0129               s=strfind(chebiID,<span class="string">' '</span>);
0130               <span class="keyword">if</span> any(s)
0131                  chebiID=chebiID(1:s-1);
0132               <span class="keyword">end</span>
0133               miriamStruct.name{1}=<span class="string">'obo.chebi:CHEBI'</span>;
0134               miriamStruct.value{1}=chebiID;
0135               model.metMiriams{metCounter}=miriamStruct;
0136           <span class="keyword">end</span>
0137       <span class="keyword">end</span>
0138     <span class="keyword">end</span>
0139 
0140     <span class="comment">%Close the file</span>
0141     fclose(fid);
0142 
0143     <span class="comment">%If too much space was allocated, shrink the model</span>
0144     model.mets=model.mets(1:metCounter);
0145     model.metNames=model.metNames(1:metCounter);
0146     model.metFormulas=model.metFormulas(1:metCounter);
0147     model.metMiriams=model.metMiriams(1:metCounter);
0148 
0149     <span class="comment">%If there was no CHEBI found, add the KEGG id as a metMiriams</span>
0150     <span class="keyword">for</span> i=1:numel(model.mets)
0151         <span class="keyword">if</span> ~isstruct(model.metMiriams{i})
0152             miriamStruct.name{1}=<span class="string">'kegg.compound'</span>;
0153             miriamStruct.value{1}=model.mets{i};
0154             model.metMiriams{i}=miriamStruct;
0155         <span class="keyword">end</span>
0156     <span class="keyword">end</span>
0157 
0158     <span class="comment">%Then load the InChI strings from another file. Not all metabolites will be</span>
0159     <span class="comment">%present in the list</span>
0160 
0161     inchIDs=cell(numel(model.mets),1);
0162     inchis=cell(numel(model.mets),1);
0163 
0164     <span class="comment">%The format is metID*tab*string</span>
0165 
0166     fid = fopen(fullfile(keggPath,<span class="string">'compound.inchi'</span>), <span class="string">'r'</span>);
0167 
0168     <span class="comment">%Loop through the file</span>
0169     counter=1;
0170     <span class="keyword">while</span> 1
0171       <span class="comment">%Get the next line</span>
0172       tline = fgetl(fid);
0173 
0174       <span class="comment">%Abort at end of file</span>
0175       <span class="keyword">if</span> ~ischar(tline)
0176           <span class="keyword">break</span>;
0177       <span class="keyword">end</span>
0178 
0179       <span class="comment">%Get the ID and the InChI</span>
0180       inchIDs{counter}=tline(1:6);
0181       inchis{counter}=tline(14:end);
0182       counter=counter+1;
0183     <span class="keyword">end</span>
0184 
0185     <span class="comment">%Close the file</span>
0186     fclose(fid);
0187 
0188     inchIDs=inchIDs(1:counter-1);
0189     inchis=inchis(1:counter-1);
0190 
0191     <span class="comment">%Find the metabolites that had InChI strings and add them to the model</span>
0192     [a b]=ismember(inchIDs,model.mets);
0193 
0194     <span class="comment">%If there were mets with InChIs but that were not in the list</span>
0195     <span class="keyword">if</span> ~all(a)
0196        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(<span class="string">'Not all metabolites with InChI strings were found in the original list'</span>);  
0197     <span class="keyword">end</span>
0198 
0199     model.inchis=cell(numel(model.mets),1);
0200     model.inchis(:)={<span class="string">''</span>};
0201     model.inchis(b)=inchis;
0202 
0203     <span class="comment">%Remove composition if InChI was found</span>
0204     model.metFormulas(b)={<span class="string">''</span>};
0205     
0206     <span class="comment">%Saves the model</span>
0207     save(metsFile,<span class="string">'model'</span>);
0208 <span class="keyword">end</span>
0209 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 06-Jan-2014 14:58:12 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>